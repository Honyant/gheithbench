# CS429H Project 4

## Task
Implement a compiler from the FUN language to AArch64 assembly. Your compiler reads .fun source files and outputs .s assembly that is then cross-compiled and run under QEMU.

## Assignment Specification
Objectives:
~~~~~~~~~~~

    - Become better at AArch64 assembly

Assignment:
~~~~~~~~~~~

    - Implement a fun to AArch64 compiler
    - Learn about cross compilers and emulators and how to use them

The fun language is defined in p2 with one extension:

    - The global variable 'argc' contains the number of arguments passed to
      the compiled program.

      For example:
          make t0.arm   # produces the ARM executable corresponding to t0.fun
          qemu-aarch64 ./t0.arm a b  # argc will be set to 3

Mixing architectures:
~~~~~~~~~~~~~~~~~~~~~

This assignment involves:

(1) writing a simple-minded compiler (fun => aarch64 assembly)

    - written in C/C++
    - compiled on x86-64
    - runs on x86-64

(2) assembling the generated code using the aarch64 cross tools

    - runs on x86-64
    - accepts AArch64 assembly
    - produces AArch64 executable

(3) running the generated executable using qemu-aarach64

    - runs on x86-64
    - emulates aarch64

The Makefile automates all that but you need to understand how it does it

The aarch64 tools:
~~~~~~~~~~~~~~~~~~

Cross tool-chain (compilers, assembler, linker, objdump, ...):
   
    ~gheith/public/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu

QEMU (emulator):

    ~gheith/public/qemu_5.1.0_old/bin/qemu-aarch64


Important "make" targets:
~~~~~~~~~~~~~~~~~~~~~~~~~

The Makefile automates your tasks.

make                          # builds the compiler
make test                     # runs all tests
make t0.test                  # runs t0
make t0.s                     # generates the AArch64 assembly for t0.fun
make t0.arm                   # generates the AArch64 executable for t0.fun

Important files:
~~~~~~~~~~~~~~~~

*.cxx           compiler C++ files
*.c             compiler C files
*.h             compiler headers
build/funcc     the compiler (generated by running make)

t0.fun          fun program for t0
t0.ok           expected output for t0
t0.args         arguments to pass when running t0.arm

t0.s            the result of running "build/funcc t0.fun"
                should contain AArch64 assembly instructions
t0.arm          the AArch64 statically linked binary generated from t0.s

t0.out          the output you get when running t0.arm and giving the
                arguments in t0.args


Generated files:
~~~~~~~~~~~~~~~~

    for each test:

        <test>.out    output from running the test
        <test>.diff   differences between the actual and expected output
        <test>.result pass/fail

To run tests:
~~~~~~~~~~~~~

    make test

To make the output less noisy:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

    make -s test

To run one test
~~~~~~~~~~~~~~~

    make -s t0.test

To run by hand
~~~~~~~~~~~~~~

    make
    ./build/funcc t0.fun
    qemu-aarch64 ./t0.arm x y z

## Workspace Files
The following files are in your workspace:
```
main.cxx
Makefile
README
```

There are 63 tests available. Tests are located in the `tests/` directory (or flat in the workspace for P5).

## Instructions
1. Read and understand all provided source files in your workspace.
2. Implement the required functionality by modifying the source files.
3. To compile and test, use the `./exec` wrapper which runs commands in a Linux
   environment with all necessary tools:
   - `./exec 'make'` — compile
   - `./exec 'make -s test'` — run all tests
4. You can edit files directly — they are shared with the build environment.
5. `aarch64-linux-gnu-gcc` and `qemu-aarch64-static` are available in the build environment.
6. Focus on correctness first, then optimization.

## Constraints
- Do NOT modify the Makefile, README, or any test files (.ok files).
- Do NOT modify the REPORT.txt file.
- You may create new source files if needed, but prefer modifying existing ones.
- The code must compile without warnings (`-Wall -Werror` is enabled).
