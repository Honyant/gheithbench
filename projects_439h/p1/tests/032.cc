#include "debug.h"
#include "critical.h"
#include "atomic.h"

static uint32_t counter = 0;

const char* duck[40] = {"***\n",
"***                  ▒▒▒▒▒▒▒▒▒▒▒▒                                            \n",
"***                ▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒                                          \n",
"***              ▓▓▒▒▒▒░░░░░░░░░░▓▓▓▓                                        \n",
"***            ░░▒▒▒▒░░▓▓░░░░░░░░░░▓▓                                        \n",
"***            ░░▒▒▒▒░░▒▒░░░░░░  ░░▓▓▒▒                                      \n",
"***        ░░▓▓░░▒▒▒▒▒▒░░░░░░░░░░░░▒▒▓▓                                      \n",
"***  ░░░░░░░░░░░░▒▒▒▒▒▒▒▒░░░░▒▒▒▒░░░░▓▓                                      \n",
"***                    ▒▒▓▓▓▓▒▒▒▒░░▒▒▓▓                                      \n",
"***                        ▓▓▒▒░░░░▒▒▓▓                                      \n",
"***                        ▓▓▒▒░░░░▒▒                                        \n",
"***                      ▓▓▒▒░░  ░░▒▒                                        \n",
"***                  ▓▓▓▓▒▒░░░░░░▓▓                                          \n",
"***              ▓▓▒▒▒▒▒▒▒▒▒▒░░▒▒                                            \n",
"***            ▓▓▓▓  ▓▓▓▓▓▓▓▓▓▓                                              \n",
"***          ▓▓██▓▓▓▓        ▓▓▒▒▒▒▒▒▒▒                                      \n",
"***        ██▓▓▒▒▓▓▓▓▓▓▓▓██▓▓██░░░░░░▒▒▒▒▒▒▒▒                                \n",
"***      ▓▓▓▓▒▒▓▓▓▓▓▓▓▓▓▓████░░░░░░░░░░░░░░▓▓▓▓▓▓                            \n",
"***      ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██▓▓▓▓▓▓▒▒▒▒▒▒▒▒░░░░░░  ▓▓▓▓                        \n",
"***    ██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒░░▓▓▓▓▓▓▓▓▒▒▒▒▒▒░░░░░░  ▓▓▓▓                    \n",
"***    ██▒▒▓▓▓▓▓▓▓▓██▒▒▒▒▒▒▒▒▒▒░░░░████▓▓▓▓▒▒▒▒▒▒▒▒░░░░  ▓▓▓▓                \n",
"***    ██▒▒▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░████▓▓▓▓▒▒▒▒▒▒░░░░    ▓▓              \n",
"***    ██▓▓▓▓▓▓██▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░░░░░░░██████████▓▓▓▓░░░░  ▓▓▓▓          \n",
"***    ██▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒░░░░░░░░░░░░░░░░░░░░████████████▒▒▓▓░░░░▓▓        \n",
"***    ██▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░░░░░░░░░░░░░░░  ████████░░░░▓▓▓▓    ▓▓    \n",
"***    ████▓▓██▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░░░░░░░░░░░░░░░░░    ██░░██████▓▓██    ██  \n",
"***      ██████▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░░░░░░░░░░░░░░░░░░░  ▓▓████████▓▓▓▓▓▓    \n",
"***      ░░████▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░░░░░░░░░░░▒▒▒▒▒▒░░            ░░  ░░░░░░\n",
"***          ▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░██████░░░░░░░░░░░░  \n",
"***            ▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░░░████▓▓▓▓          \n",
"***              ▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒                  \n",
"***                  ▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒                              \n",
"***                            ▓▓▓▓▓▓▓▓▓▓                                    \n",
"***                            ▒▒▓▓▒▒▓▓▒▒                                    \n",
"***                              ▒▒  ▒▒                                      \n",
"***                              ▒▒  ▒▒                                      \n",
"***                              ▒▒  ▒▒                                      \n",
"***                              ▒▒  ▒▒                                      \n",
"***                    ▒▒▒▒▒▒▒▒  ▒▒  ▒▒                                      \n",
"***                ░░░░▒▒▒▒▒▒▒▒░░▒▒▒▒▒▒                                      \n"
};

void subsubwork(){
    Debug::printf(duck[counter]);
    counter ++;
}

void subwork() {
    Debug::printf(duck[counter]);
    counter ++;

    critical(subsubwork);
    
    Debug::printf(duck[counter]);
    counter ++;
}

void work() {
    Debug::printf(duck[counter]);
    counter ++;

    critical(subwork);
    
    Debug::printf(duck[counter]);
    counter ++;
}

/* Called by all cores */
void kernelMain(void) {
    // The C way, use function pointers
    critical(work);
    critical(work);
}
